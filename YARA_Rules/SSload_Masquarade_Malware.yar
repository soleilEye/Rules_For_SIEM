rule SSload_Masquarade_Malware {
   meta:
      description = "Detects SSload Malware"
      author = "Nu Ya"
      reference = "HTB Sherlock Cuidado"
      date = "2025-08-09"
      hash1 = "dcae57ec4b69236146f744c143c42cc8bdac9da6e991904e6dbf67ec1179286a"
   strings:
      $x1 = "(This operation cannot be undone.)Error writing to file: [2].  Verify that you have access to that directory.Installer stopped p" ascii
      $x2 = "Your original configuration will be restored.You can only type a separator character here.Failed to install [2] Control Panel ap" ascii
      $x3 = "[2]Error converting file time to local time for file: [3]. GetLastError: [2].Path: [2] is not a parent of [3].On the dialog [2] " ascii
      $x4 = "ressDlgAdminWelcomeDlgAI_SET_ADMINExecuteActionExitDialogFatalErrorPrepareDlgUserExitaicustact.dllcmdlinkarrowdialog.svgbanner.s" ascii
      $x5 = "AttributesPatchSizeFile_PatchTypeActionConditionSequenceCostFinalizeCostInitializeTableNameInstallFinalizeInstallInitializeInsta" ascii
      $x6 = "Text_Next_Orig]:[Text_Next]:AI_PATCH|[Text_Next]:[Text_Install]:AI_PATCHAI_Init_WelcomeDlg[AI_ButtonText_Next_Orig]:[ButtonText_" ascii
      $x7 = "ressDlgAdminWelcomeDlgAI_SET_ADMINExecuteActionExitDialogFatalErrorPrepareDlgUserExitaicustact.dllcmdlinkarrowdialog.svgbanner.s" ascii
      $x8 = "Your original Firewall configuration will be restored.Invalid Firewall network scope: [2].There was an error registering port wi" ascii
      $x9 = "SUMEAI_SET_INSTALLAI_SET_MAINTAI_SET_PATCHDetectModernWindowsDoEventsAI_DATA_SETTERCustomActionData[AI_Init_PatchWelcomeDlg]AI_D" ascii
      $x10 = "ledVersionNTInstallExecuteAI_USE_STD_ODBC_MGRIsolateComponentsRedirectedDllSupportPATCHAI_EXTREG <> \"No\"AI_UPGRADE<>\"No\"AI_U" ascii
	  $x11 = "AICustAct.pdb" fullword wide
	  $x12 = "JobRelease"
	  $x13 = "LSA add account rights return code:"
      $s1 = "api-ms-win-core-synch-l1-2-0.dll" fullword wide /* reversed goodware string 'lld.0-2-1l-hcnys-eroc-niw-sm-ipa' */
      $s2 = " was an error during the SQL script execution process.ODBC Error: [2] ([3]).SQL script parse error: invalid syntax.Internal erro" ascii
      $s3 = "ze cabinet file server. The required file 'CABINET.DLL' may be missing.Database: [2]. Insufficient parameters for Execute.Databa" ascii
      $s4 = "etDescriptionAdminExecuteSequenceNIdentifierName of action to invoke, either in the engine or the handler DLL.ActionTextYTextLoc" ascii
      $s5 = "e control [3] on the dialog [2].Creating the [2] table failed.Creating a cursor to the [2] table failed.Executing the [2] view f" ascii
      $s6 = "WShell32.dll" fullword wide
      $s7 = "> 3))((NOT AI_INSTALL) AND (NOT AI_PATCH)) OR ((CTRLS <> 1) AND (CTRLS <> 3))ShowMsiLogFileLocationEndDialogAI_INSTALLNewDialogA" ascii
      $s8 = "mage\"ReinstallModeecmusReinstallRMShutdownAndRestartAppsShutdownOption = \"All\"[[AI_CommitButton]][Text_Install]AI_DOWNGRADE40" ascii
      $z1 = "%s\\System32\\cmd.exe" fullword wide
      $z2 = "[SystemFolder]msiexec.exe" fullword wide
	  $z3 = "ADVAPI32.dll"
	  $z4 = "adobe"
   condition:
      ( uint16(0) == 0xcfd0 and filesize < 4000KB and ((1 of ($x*) or 2 of ($s*)) and all of ($z*)) )
}

